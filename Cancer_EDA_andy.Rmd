---
title: "Cancer Mortality Exploration"
author: "w203 Teaching Team"
output: pdf_document
---

## Background

In this lab, imagine that your team is hired by a health government agency. They would like to understand factors that predict cancer mortality rates, with the ultimate aim of identifying communities for social interventions, and of understanding which interventions are likely to have the most impact.  Your team was hired to perform an exploratory analysis to help the agency address their goals.


## Data

You are given a dataset for a selection of US counties, **"cancer.csv"**.  The dependent (or target) variable in this data is named "deathRate".

The labels of some of the variables are listed below; the rest of the variables should be self-explanatory.

\begin{tabular}{rl}
avgAnnCount: &"2009-2013 mean incidences per county"\\
povertyPercent: &"Percent of population below poverty line"\\
popEst2015: &"Estimated population by county 2015"\\
PctPrivateCoverage: &"Percentage of the population with private insurance coverage"\\
PctPublicCoverage: &"Percentage of the population with public insurance coverage"
\end{tabular}

## Objective

Perform an exploratory analysis to understand how county-level characteristics are related to cancer mortality.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load}
setwd('~/Documents/MIDS/W203/hw/Lab_1/Cancer_EDA')
Cancer = read.csv('cancer.csv')
```

```{r}
colnames(Cancer)
nrow(Cancer)
summary(Cancer)
attach(Cancer)
```

```{r}
histWithMean <- function(vector, name) {
  hist(vector, col=rgb(0,0,1,1/4), main=paste("Histogram of ", name), xlab=name)
  abline(v = mean(vector), col="red", lwd=2)
}
```


```{r}
histWithMean(deathRate, "deathRate")
```

### Population

```{r}
histWithMean(popEst2015, "popEst2015") # looks like "power law distribution"
histWithMean(log(popEst2015), "log(popEst2015)")
Cancer$logPopEst2015 = log(popEst2015)

histWithMean(AvgHouseholdSize, "AvgHouseholdSize") # impossible 0's
histWithMean(AvgHouseholdSize[AvgHouseholdSize > 1], "AvgHouseholdSize")
cleanAvgHouseholdSize <- AvgHouseholdSize > 1

histWithMean(PercentMarried, "PercentMarried")

histWithMean(avgAnnCount, "avgAnnCount") # looks like "power law distribution"
histWithMean(log(avgAnnCount), "log(avgAnnCount)")
Cancer$logAvgAnnCount = log(avgAnnCount)

histWithMean(BirthRate, "BirthRate")
```

### Age

```{r}
histWithMean(MedianAge, "MedianAge") # impossible over 200
histWithMean(MedianAge[MedianAge < 200], "MedianAge")
cleanMedianAge <- MedianAge < 200

histWithMean(MedianAgeMale, "MedianAgeMale")
histWithMean(MedianAgeFemale, "MedianAgeFemale")
```

### Income

```{r}
histWithMean(medIncome, "medIncome") # looks like "power law distribution"
histWithMean(log(medIncome), "log(medIncome)")
Cancer$logMedIncome = log(medIncome)

histWithMean(povertyPercent, "povertyPercent")

plot(deathRate ~ binnedInc)

histWithMean(PctEmployed16_Over, "PctEmployed16_Over") # NA's: 152
cleanPctEmployed16_Over <- !is.na(PctEmployed16_Over)

histWithMean(PctUnemployed16_Over, "PctUnemployed16_Over")
```

### Race

```{r}
histWithMean(PctWhite, "PctWhite")
histWithMean(PctBlack, "PctBlack")
histWithMean(PctAsian, "PctAsian")
histWithMean(PctOtherRace, "PctOtherRace")
```

### Education

```{r}
histWithMean(PctNoHS18_24, "PctNoHS18_24")
histWithMean(PctHS18_24, "PctHS18_24")
histWithMean(PctHS25_Over, "PctHS25_Over")
histWithMean(PctSomeCol18_24, "PctSomeCol18_24") # NA's: 2285
cleanPctSomeCol18_24 <- !is.na(PctSomeCol18_24)
histWithMean(PctBachDeg18_24, "PctBachDeg18_24")
histWithMean(PctBachDeg25_Over, "PctBachDeg25_Over")
```

### Insurance

```{r}
histWithMean(PctPrivateCoverage, "PctPrivateCoverage")
histWithMean(PctEmpPrivCoverage, "PctEmpPrivCoverage")
histWithMean(PctPublicCoverage, "PctPublicCoverage")
```

```{r}
# some columns were added, so lets update the attached version
detach(Cancer)
attach(Cancer)
```

### Get all the numeric type columns, find correlations with deathRate, and sort by descending absolute value

```{r}
numericColumns <- sapply(Cancer, is.numeric)
NumericCancer <- Cancer[, numericColumns]
correlations <- apply(NumericCancer, 2, function(col) cor(col, deathRate))
correlations[order(abs(correlations), decreasing=TRUE)]
```

### Check correlations for the "cleaned" variables

```{r}
cor(AvgHouseholdSize[cleanAvgHouseholdSize], deathRate[cleanAvgHouseholdSize])
cor(MedianAge[cleanMedianAge], deathRate[cleanMedianAge])
cor(PctEmployed16_Over[cleanPctEmployed16_Over], deathRate[cleanPctEmployed16_Over]) # -0.4120458
cor(PctSomeCol18_24[cleanPctSomeCol18_24], deathRate[cleanPctSomeCol18_24])
```

### Plot deathRate with all variables with at least a weak correlation

```{r}
plot(PctBachDeg25_Over, deathRate, cex=0.2)
plot(logMedIncome, deathRate, cex=0.2)
plot(povertyPercent, deathRate, cex=0.2)
plot(medIncome, deathRate, cex=0.2)
plot(PctEmployed16_Over[cleanPctEmployed16_Over], deathRate[cleanPctEmployed16_Over], cex=0.2)
plot(PctHS25_Over, deathRate, cex=0.2)
plot(PctPublicCoverage, deathRate, cex=0.2)
plot(PctPrivateCoverage, deathRate, cex=0.2)
plot(PctUnemployed16_Over, deathRate, cex=0.2)
```
